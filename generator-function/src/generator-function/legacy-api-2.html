<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Legacy API</title>
  <!--

A ideia de usar a generator function neste cenário seria dividir o processamento e a renderização em pequenos pedaços e espaçar essa renderização ao longo do tempo, para evitar bloquear o thread principal do navegador por um longo período.

   -->
</head>

<body>
  <table id="usersTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nome</th>
        <th>Email</th>
      </tr>
    </thead>

    <tbody></tbody>
  </table>

  <script>
    (function () {
      // Esta função cria um mock de um grande conjunto de dados de usuários
      function createUsersMock(n) {
        let users = [];
        for (let i = 0; i < n; i++) {
          users.push({ id: i, name: `User ${i}`, email: `user${i}@example.com` });
        }
        return users;
      }

      // Obtendo os dados mockados (por exemplo, 5000 usuários)
      const largeData = createUsersMock(200000);

      function* processDataInChunks(data, chunkSize) {
        for (let i = 0; i < data.length; i += chunkSize) {
          yield data.slice(i, i + chunkSize);
        }
      }

      function handleData() {
        const dataProcessor = processDataInChunks(largeData, 50);

        function processNextChunk() {
          const chunk = dataProcessor.next().value;

          if (chunk) {
            renderChunk(chunk);
            setTimeout(processNextChunk, 0);
          }
        }

        processNextChunk();
      }

      function renderChunk(chunk) {
        const tableBody = document.querySelector('#usersTable tbody');

        for (let user of chunk) {
          const row = document.createElement('tr');

          const idCell = document.createElement('td');
          idCell.textContent = user.id;
          row.appendChild(idCell);

          const nameCell = document.createElement('td');
          nameCell.textContent = user.name;
          row.appendChild(nameCell);

          const emailCell = document.createElement('td');
          emailCell.textContent = user.email;
          row.appendChild(emailCell);

          tableBody.appendChild(row);
        }
      }

      handleData();
    })()
  </script>
</body>
</html>